HID Latency Checker
====

HID入力デバイスの応答時間を測定するプログラムです

## Description
FTDIのシリアル変換モジュールを使ってHID入力デバイスを駆動し、入力から応答までの時間を測定することができます。FT232HL等を使用することにより、デバイスを駆動するまでの時間が非常に短くなるため、精度の高い測定が可能です。キーボード、マウス、ゲームパッドに対応しています。  
解説:  http://sousuch.web.fc2.com/DIY/HID_Latency/

## Example
![BLOCK DIAGRAM](https://github.com/sousu-ch/HID_Latency/blob/master/block.png "BLOCK DIAGRAM")
1. IOボードにボタンを押すための信号を出力する。ここでタイマースタート！
2. IOボードはUSBからの信号を受けてポート論理を変化させる。
3. MOSFETを経由してソレノイドを駆動する(入力デバイスに直接接続する場合はフォトカプラでも可)
4. ソレノイドが入力デバイスのスイッチを押し込む
5. 入力デバイスからの信号を検知する。ここでタイマーストップ！

6. １～５をボタン押し、ボタン離しについて繰り返す

１～５にそれぞれ遅延がありますが、３～４のソレノイド遅延が特に大なので、後からその分を差し引くと良いでしょう。

## Requirement
FTDI社から提供されているFTDIドライバのラッパーライブラリ(FTD2XX_NET)を使っています。
実行にはFTD2XX_NET.dllが必要で、2022年現在下記URLからダウンロードできます。  
https://ftdichip.com/software-examples/code-examples/csharp-examples/

ハードとしてはFTDIのシリアル変換モジュールが必要です。
FT232HLを強く推奨します。出力時間の精度が高いです。

DirectX SDKを使用しています。  

動作環境は.NET Freamwork 3.5です。  
Windows XP SP3,Windows7 SP1,Windows11で動作しました。

## Usage
FTDIのシリアル変換モジュールおよび測定対象を、あらかじめUSBに接続した状態で、HID_Latency.exeを起動します。
動作としては下記ような流れになります。

1. FTD2XXでポート出力(Bit-bangモードでport0(ex.TXD)=H:ボタン押信号)して、タイマースタート
2. キーボードのHキー、マウスの左クリック、ゲームパッドのボタン１のいずれかの入力があったらタイマーストップ
3. 次の出力まで少し待つ。待ち時間は毎回変更する（0.1ms単位で0から32msまで加算ループ）
4. FTD2XXでポート出力（ボタン離信号）して、タイマースタート
5. 2.で検知したいずれかのキーが離されたらタイマーストップ
6. 2.と5.で測定したそれぞれの時間(ms)を記憶する

7. １～６を繰り返す

キーボードのCキー押下で記憶した全データをcsvに吐き出すことができます

注意点としては、最初の１回は自動で始まりませんので、マウスクリックするなどの必要があり、その１回目のデータはcsvから手動で除去する必要があります。

csvは下記のフォーマットで出力されます.  
押し応答[ms],離し応答[ms]  
押し応答[ms],離し応答[ms]  
...

## Install
DirectX SDKとFTDIのシリアル変換モジュールのドライバをインストールしておき、FTD2XX.dllとHID_Latency.exeを同じフォルダに置いて実行してください。

## Licence
The source code is licensed MIT.
